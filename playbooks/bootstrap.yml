---
- hosts: all
  vars:
    provision_repo: "https://github.com/usernamenumber/provision/"
    provision_dir: "/usr/local/tunapanda/provision"
    provision_ver: "cubie_vagrant"
    edx_repo: "https://github.com/tunapanda/configuration/"
    edx_dir: "/usr/local/tunapanda/edx"
    edx_ver: "master"
  tasks:
  - name: "install dependencies"
    apt: 
      name="{{ item }}"
      state=installed
    with_items:
      - git

  - name: "Cloning/updating core repo"
    include: "bootstrap_git.yml"
    vars:
      dir: "{{ provision_dir }}"
      repo: "{{ provision_repo }}"
      ver: "{{ provision_dir }}"

  - name: "Cloning/updating edx repo"
    include: "bootstrap_git.yml"
    vars:
      dir: "{{ provision_dir }}"
      repo: "{{ provision_repo }}"
      ver: "{{ provision_dir }}"

  - name: "provision at boot"
    lineinfile:
      dest="/etc/rc.local"
      state="present"
      regexp="{{ provision_dir }}"
      insertbefore="^exit"
      line="[ -x '{{ provision_dir }}/scripts/bootstrap.sh' ] && {{ provision_dir }}/scripts/bootstrap.sh"

